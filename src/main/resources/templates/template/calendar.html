<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset='utf-8' />
<link href="/css/main.css" rel='stylesheet' />
  <script src="/js/main2.js"></script>
  <title>FullCalendar</title>
  <link rel=" shortcut icon" href="/image/favicon.ico">
  <link rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<script>
  document.addEventListener('DOMContentLoaded', async function() {
    var today;
    var test;

    $.ajax({
        type: "POST",
        url: "/calendar/gettoday",
        success:function (res){
          today = res.today;
        },
        error:function(){
          alert("통신 실패")
        }
    });

    await $.ajax({
      type: "POST",
      url: "/calendar/getcalendar",
      success:function (res) {
        test = res;
        console.log(res);
      },
      error:function () {
        alert("실패")
      }
      });

    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
      },
      initialDate: today,
      navLinks: true, // can click day/week names to navigate views
      businessHours: true, // display business hours
      editable: true,
      selectable: true,
      events: test,


      select: function (startDate, endDate, jsEvent, view) {
        $(".fc-body").unbind('click', function (e) {
          const dropDown = document.querySelector('#contextMenu');
          dropDown.style.display = '';
        });
        $(".fc-body").bind('click', 'tr > td', function (e) {
          $("#contextMenu")
                  .addClass("contextOpened")
                  .css({
                    position : "absolute",
                    left: e.pageX,
                    top: e.pageY,
                    zIndex: 500
                  });

          return false
        });

        /**
         * 날짜 클릭시 카테고리 선택 메뉴 */
        var $contextMenu = $("#calendar");
        $contextMenu.on("click", "a", function (e){
          console.log('카테고리 클릭');
          e.preventDefault();
          if ($(this).data().role !== 'close') {
            newEvent(startDate, endDate, $(this).html());
          }
          $contextMenu.removeClass("contextOpend");
          $contextMenu.hide();
        })
      }
    });

      /* [
        {
          title: 'Business Lunch',
          start: '2020-09-03T13:00:00',
          constraint: 'businessHours'
        },
        {
          title: 'Meeting',
          start: '2020-09-13T11:00:00',
          constraint: 'availableForMeeting', // defined below
          color: '#257e4a'
        },
        {
          title: 'Conference',
          start: '2020-09-18',
          end: '2020-09-20'
        },
        {
          title: 'Party',
          start: '2020-09-29T20:00:00'
        },

        // areas where "Meeting" must be dropped
        {
          groupId: 'availableForMeeting',
          start: '2020-09-11T10:00:00',
          end: '2020-09-11T16:00:00',
          display: 'background'
        },
        {
          groupId: 'availableForMeeting',
          start: '2020-09-13T10:00:00',
          end: '2020-09-13T16:00:00',
          display: 'background'
        },

        // red areas where no events can be dropped
        {
          start: '2020-09-24',
          end: '2020-09-28',
          overlap: false,
          display: 'background',
          color: '#ff9f89'
        },
        {
          start: '2020-09-06',
          end: '2020-09-08',
          overlap: false,
          display: 'background',
          color: '#ff9f89'
        }
      ]});*/


    calendar.render();
  });


</script>
  <script src="http://code.jquery.com/jquery-latest.js"></script>
<style>

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 1100px;
    margin: 0 auto;
  }

</style>
</head>
<body>

  <div id='calendar'></div>
  <div id="contextMenu" class="dropdown clearfix">
    <ul class="dropdown-menu dropNewEvent" role="menu" aria-labelledby="dropdownMenu"
        style="display:block;position:static;margin-bottom:5px;">
      <li><a tabindex="-1" href="#">일정등록</a></li>

      <li class="divider"></li>
      <li><a tabindex="-1" href="#" data-role="close">Close</a></li>
    </ul>
  </div>
</body>

</html>
